<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FQDN Security Scanner - Multi-Agent System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
        .pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; }
        .status-active { background: #22c55e; box-shadow: 0 0 8px #22c55e; }
        .status-idle { background: #6b7280; }
        .status-error { background: #ef4444; box-shadow: 0 0 8px #ef4444; }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen">
    <div id="app">
        <!-- Header -->
        <header class="bg-gray-800 border-b border-gray-700 sticky top-0 z-50">
            <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <span class="text-2xl">üîê</span>
                    <h1 class="text-xl font-bold">FQDN Security Scanner</h1>
                    <span class="text-xs bg-purple-600 px-2 py-1 rounded-full">Multi-Agent</span>
                </div>
                <div class="flex items-center space-x-4">
                    <button @click="activeTab = activeTab === 'agents' ? 'scanner' : 'agents'"
                            class="text-sm px-3 py-1.5 rounded-lg transition"
                            :class="activeTab === 'agents' ? 'bg-purple-600' : 'bg-gray-700 hover:bg-gray-600'">
                        ü§ñ [[ activeTab === 'agents' ? 'Scanner' : 'Agents' ]]
                    </button>
                    <a href="https://github.com/XY-world/fqdn-security-scanner" target="_blank" 
                       class="text-gray-400 hover:text-white transition">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                        </svg>
                    </a>
                </div>
            </div>
        </header>

        <main class="max-w-7xl mx-auto px-4 py-8">
            
            <!-- Agent Orchestra Panel -->
            <div v-if="activeTab === 'agents'" class="space-y-6">
                <!-- Agent Cards -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div v-for="(agent, key) in agents" :key="key"
                         class="bg-gray-800 rounded-xl p-5 border border-gray-700 hover:border-gray-600 transition">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center space-x-3">
                                <span class="text-2xl">[[ agent.icon ]]</span>
                                <div>
                                    <h3 class="font-semibold">[[ agent.display_name ]]</h3>
                                    <div class="flex items-center space-x-2 text-xs text-gray-400">
                                        <span class="status-dot" :class="'status-' + agent.status"></span>
                                        <span class="capitalize">[[ agent.status ]]</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="text-sm text-gray-400 mb-3" v-if="agent.last_run">
                            Last run: [[ formatTimeAgo(agent.last_run) ]]
                        </div>
                        
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <template v-if="key === 'discovery'">
                                <div class="bg-gray-900 rounded px-2 py-1">
                                    <span class="text-gray-500">Discoveries</span>
                                    <span class="float-right font-medium">[[ agent.stats?.discoveries || 0 ]]</span>
                                </div>
                            </template>
                            <template v-if="key === 'scanner'">
                                <div class="bg-gray-900 rounded px-2 py-1">
                                    <span class="text-gray-500">Scans</span>
                                    <span class="float-right font-medium">[[ agent.stats?.scans_completed || 0 ]]</span>
                                </div>
                                <div class="bg-gray-900 rounded px-2 py-1">
                                    <span class="text-gray-500">Modules</span>
                                    <span class="float-right font-medium">[[ agent.stats?.modules_added || 0 ]]</span>
                                </div>
                            </template>
                            <template v-if="key === 'pr_agent'">
                                <div class="bg-gray-900 rounded px-2 py-1">
                                    <span class="text-gray-500">PRs Opened</span>
                                    <span class="float-right font-medium">[[ agent.stats?.prs_opened || 0 ]]</span>
                                </div>
                                <div class="bg-gray-900 rounded px-2 py-1">
                                    <span class="text-gray-500">Merged</span>
                                    <span class="float-right font-medium">[[ agent.stats?.prs_merged || 0 ]]</span>
                                </div>
                            </template>
                        </div>
                        
                        <!-- Quick Actions -->
                        <div class="mt-3 pt-3 border-t border-gray-700">
                            <button v-if="key === 'discovery'" @click="triggerDiscovery"
                                    class="text-xs bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded transition">
                                üîç Run Discovery
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Discoveries Panel -->
                <div class="bg-gray-800 rounded-xl border border-gray-700 overflow-hidden">
                    <div class="px-6 py-4 border-b border-gray-700 flex items-center justify-between">
                        <h3 class="text-lg font-semibold">üì¢ Recent Discoveries</h3>
                        <span class="text-xs text-gray-500">[[ discoveries.length ]] items</span>
                    </div>
                    <div v-if="discoveries.length === 0" class="px-6 py-8 text-center text-gray-500">
                        No discoveries yet. Run the Discovery Agent to find new vulnerabilities.
                    </div>
                    <div v-else class="divide-y divide-gray-700">
                        <div v-for="discovery in discoveries" :key="discovery.id"
                             class="px-6 py-4 hover:bg-gray-750 transition">
                            <div class="flex items-start justify-between">
                                <div class="flex-1">
                                    <div class="flex items-center space-x-2 mb-1">
                                        <span class="text-xs px-2 py-0.5 rounded capitalize"
                                              :class="categoryClass(discovery.category)">
                                            [[ discovery.category ]]
                                        </span>
                                        <span class="text-xs px-2 py-0.5 rounded capitalize"
                                              :class="statusClass(discovery.status)">
                                            [[ discovery.status ]]
                                        </span>
                                    </div>
                                    <h4 class="font-medium">[[ discovery.title ]]</h4>
                                    <p class="text-sm text-gray-400 mt-1">[[ discovery.description ]]</p>
                                    <div class="text-xs text-gray-500 mt-2">
                                        [[ formatTimeAgo(discovery.timestamp) ]] ‚Ä¢ 
                                        <a :href="discovery.source" target="_blank" class="text-blue-400 hover:underline">Source</a>
                                    </div>
                                </div>
                                <div class="flex space-x-2 ml-4">
                                    <button v-if="discovery.status === 'new'" 
                                            @click="updateDiscoveryStatus(discovery.id, 'reviewing')"
                                            class="text-xs bg-yellow-600 hover:bg-yellow-700 px-2 py-1 rounded">
                                        Review
                                    </button>
                                    <button v-if="discovery.status === 'reviewing'"
                                            @click="triggerPRAgent(discovery.id)"
                                            class="text-xs bg-green-600 hover:bg-green-700 px-2 py-1 rounded">
                                        Implement
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Activity Stream -->
                <div class="bg-gray-800 rounded-xl border border-gray-700 overflow-hidden">
                    <div class="px-6 py-4 border-b border-gray-700">
                        <h3 class="text-lg font-semibold">üîÑ Agent Activity Stream</h3>
                    </div>
                    <div v-if="activities.length === 0" class="px-6 py-8 text-center text-gray-500">
                        No recent activity. Agents are standing by.
                    </div>
                    <div v-else class="max-h-64 overflow-y-auto">
                        <div v-for="(activity, idx) in activities" :key="idx"
                             class="px-6 py-2 text-sm border-b border-gray-700/50 hover:bg-gray-750">
                            <span class="text-gray-500">[[ formatTime(activity.timestamp) ]]</span>
                            <span class="mx-2">[[ getAgentIcon(activity.agent) ]]</span>
                            <span>[[ activity.message ]]</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Scanner Tab -->
            <div v-else class="space-y-6">
                <!-- Scan Form -->
                <div class="bg-gray-800 rounded-xl p-6 border border-gray-700">
                    <div class="flex flex-col md:flex-row gap-4">
                        <div class="flex-1">
                            <label class="block text-sm font-medium text-gray-400 mb-2">Target Domain</label>
                            <input v-model="target" type="text" 
                                   placeholder="example.com or https://example.com"
                                   class="w-full bg-gray-900 border border-gray-600 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition"
                                   @keyup.enter="startScan">
                        </div>
                        <div class="md:w-48">
                            <label class="block text-sm font-medium text-gray-400 mb-2">Timeout (sec)</label>
                            <input v-model.number="timeout" type="number" min="5" max="120"
                                   class="w-full bg-gray-900 border border-gray-600 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition">
                        </div>
                        <div class="md:w-32 flex items-end">
                            <button @click="startScan" :disabled="scanning || !target"
                                    class="w-full bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white font-semibold py-3 px-6 rounded-lg transition flex items-center justify-center space-x-2">
                                <span v-if="scanning" class="pulse">‚è≥</span>
                                <span v-else>üîç</span>
                                <span>[[ scanning ? 'Scanning...' : 'Scan' ]]</span>
                            </button>
                        </div>
                    </div>

                    <!-- Module Selection -->
                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-400 mb-2">Modules</label>
                        <div class="flex flex-wrap gap-2">
                            <button v-for="(info, key) in modules" :key="key"
                                    @click="toggleModule(key)"
                                    :class="selectedModules.includes(key) ? 'bg-blue-600 border-blue-500' : 'bg-gray-700 border-gray-600 hover:border-gray-500'"
                                    class="px-4 py-2 rounded-lg border transition flex items-center space-x-2">
                                <span>[[ info.icon ]]</span>
                                <span>[[ info.name ]]</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Progress Bar -->
                <div v-if="scanning" class="bg-gray-800 rounded-xl p-6 border border-gray-700">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm text-gray-400">Scanning [[ currentModule || '...' ]]</span>
                        <span class="text-sm text-gray-400">[[ progress ]]%</span>
                    </div>
                    <div class="w-full bg-gray-700 rounded-full h-2">
                        <div class="bg-blue-600 h-2 rounded-full transition-all duration-300"
                             :style="{ width: progress + '%' }"></div>
                    </div>
                </div>

                <!-- Results -->
                <div v-if="results" class="space-y-6">
                    <!-- Summary Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div class="bg-gray-800 rounded-xl p-6 border border-gray-700">
                            <div class="text-sm text-gray-400 mb-1">Risk Score</div>
                            <div class="text-4xl font-bold" :class="riskColor">[[ results.risk_score ]]/100</div>
                            <div class="text-sm mt-1" :class="riskColor">[[ riskLevel ]]</div>
                        </div>
                        <div class="bg-gray-800 rounded-xl p-6 border border-gray-700">
                            <div class="text-sm text-gray-400 mb-1">Total Findings</div>
                            <div class="text-4xl font-bold text-white">[[ results.findings.length ]]</div>
                        </div>
                        <div class="bg-gray-800 rounded-xl p-6 border border-gray-700">
                            <div class="text-sm text-gray-400 mb-1">Critical + High</div>
                            <div class="text-4xl font-bold text-red-500">
                                [[ (results.severity_summary.critical || 0) + (results.severity_summary.high || 0) ]]
                            </div>
                        </div>
                        <div class="bg-gray-800 rounded-xl p-6 border border-gray-700">
                            <div class="text-sm text-gray-400 mb-1">Target</div>
                            <div class="text-xl font-bold text-white truncate">[[ results.target ]]</div>
                            <div class="text-xs text-gray-500 mt-1">[[ formatTime(results.scan_time) ]]</div>
                        </div>
                    </div>

                    <!-- Severity Breakdown -->
                    <div class="bg-gray-800 rounded-xl p-6 border border-gray-700">
                        <h3 class="text-lg font-semibold mb-4">Severity Breakdown</h3>
                        <div class="flex flex-wrap gap-4">
                            <div v-for="(count, severity) in results.severity_summary" :key="severity"
                                 class="flex items-center space-x-2 px-4 py-2 rounded-lg"
                                 :class="severityBgClass(severity)">
                                <span>[[ severityIcon(severity) ]]</span>
                                <span class="font-medium capitalize">[[ severity ]]</span>
                                <span class="font-bold">[[ count ]]</span>
                            </div>
                        </div>
                    </div>

                    <!-- Findings List -->
                    <div class="bg-gray-800 rounded-xl border border-gray-700 overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-700 flex items-center justify-between">
                            <h3 class="text-lg font-semibold">Findings</h3>
                            <div class="flex space-x-2">
                                <button @click="downloadReport('json')" class="text-sm px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded transition">JSON</button>
                                <button @click="downloadReport('md')" class="text-sm px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded transition">Markdown</button>
                                <button @click="downloadReport('html')" class="text-sm px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded transition">HTML</button>
                            </div>
                        </div>
                        <div v-if="results.findings.length === 0" class="px-6 py-12 text-center text-gray-500">
                            ‚úÖ No security issues found!
                        </div>
                        <div v-else class="divide-y divide-gray-700">
                            <div v-for="(finding, index) in sortedFindings" :key="index"
                                 class="px-6 py-4 hover:bg-gray-750 transition cursor-pointer"
                                 @click="toggleFinding(index)">
                                <div class="flex items-start space-x-4">
                                    <span class="text-xl">[[ severityIcon(finding.severity) ]]</span>
                                    <div class="flex-1 min-w-0">
                                        <div class="flex items-center space-x-2 mb-1">
                                            <span class="text-xs px-2 py-0.5 rounded uppercase font-medium"
                                                  :class="severityBgClass(finding.severity)">
                                                [[ finding.severity ]]
                                            </span>
                                            <span class="text-xs text-gray-500">[[ finding.module ]]</span>
                                        </div>
                                        <h4 class="font-medium">[[ finding.title ]]</h4>
                                        <p class="text-sm text-gray-400 mt-1">[[ finding.description ]]</p>
                                        <div v-if="expandedFindings.includes(index)" class="mt-3 space-y-2">
                                            <div v-if="finding.remediation" class="bg-green-900/30 border border-green-800 rounded-lg p-3">
                                                <div class="text-xs text-green-400 font-medium mb-1">Remediation</div>
                                                <p class="text-sm text-green-300">[[ finding.remediation ]]</p>
                                            </div>
                                        </div>
                                    </div>
                                    <span class="text-gray-500">[[ expandedFindings.includes(index) ? '‚ñº' : '‚ñ∂' ]]</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="border-t border-gray-800 mt-12 py-6 text-center text-gray-500 text-sm">
            FQDN Security Scanner v1.1.0 ‚Ä¢ Multi-Agent System ‚Ä¢ Built with üîê by XY-world
        </footer>
    </div>

    <script>
        const { createApp, ref, computed, onMounted } = Vue;
        
        createApp({
            delimiters: ['[[', ']]'],
            setup() {
                const activeTab = ref('scanner');
                const target = ref('');
                const timeout = ref(30);
                const modules = ref({{ modules | tojson }});
                const selectedModules = ref(Object.keys({{ modules | tojson }}));
                const scanning = ref(false);
                const scanId = ref(null);
                const progress = ref(0);
                const currentModule = ref('');
                const results = ref(null);
                const expandedFindings = ref([]);
                
                // Agent state
                const agents = ref({{ agents | tojson }});
                const activities = ref([]);
                const discoveries = ref([]);
                
                // Fetch agent data
                const fetchAgents = async () => {
                    try {
                        const res = await fetch('api/agents');
                        agents.value = await res.json();
                    } catch (e) { console.error('Fetch agents error:', e); }
                };
                
                const fetchActivities = async () => {
                    try {
                        const res = await fetch('api/agents/activities');
                        activities.value = await res.json();
                    } catch (e) { console.error('Fetch activities error:', e); }
                };
                
                const fetchDiscoveries = async () => {
                    try {
                        const res = await fetch('api/agents/discoveries');
                        discoveries.value = await res.json();
                    } catch (e) { console.error('Fetch discoveries error:', e); }
                };
                
                const refreshAgentData = async () => {
                    await Promise.all([fetchAgents(), fetchActivities(), fetchDiscoveries()]);
                };
                
                onMounted(() => {
                    refreshAgentData();
                    setInterval(refreshAgentData, 5000);  // Refresh every 5 seconds
                });
                
                const triggerDiscovery = async () => {
                    try {
                        await fetch('api/agents/discovery/trigger', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ demo: true })
                        });
                        await refreshAgentData();
                    } catch (e) { console.error('Trigger discovery error:', e); }
                };
                
                const triggerPRAgent = async (discoveryId) => {
                    try {
                        await fetch('api/agents/pr/trigger', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ discovery_id: discoveryId })
                        });
                        await updateDiscoveryStatus(discoveryId, 'implemented');
                        await refreshAgentData();
                    } catch (e) { console.error('Trigger PR agent error:', e); }
                };
                
                const updateDiscoveryStatus = async (id, status) => {
                    try {
                        await fetch(`api/agents/discoveries/${id}`, {
                            method: 'PATCH',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ status })
                        });
                        await fetchDiscoveries();
                    } catch (e) { console.error('Update discovery error:', e); }
                };
                
                const getAgentIcon = (agentName) => {
                    const icons = { discovery: 'üîç', scanner: 'üõ°Ô∏è', pr_agent: 'üîß' };
                    return icons[agentName] || 'ü§ñ';
                };
                
                const categoryClass = (category) => {
                    const classes = {
                        cve: 'bg-red-900/50 text-red-300',
                        technique: 'bg-purple-900/50 text-purple-300',
                        tool: 'bg-blue-900/50 text-blue-300',
                        research: 'bg-green-900/50 text-green-300',
                        news: 'bg-gray-700 text-gray-300'
                    };
                    return classes[category] || classes.news;
                };
                
                const statusClass = (status) => {
                    const classes = {
                        new: 'bg-yellow-900/50 text-yellow-300',
                        reviewing: 'bg-blue-900/50 text-blue-300',
                        implemented: 'bg-green-900/50 text-green-300',
                        dismissed: 'bg-gray-700 text-gray-400'
                    };
                    return classes[status] || classes.new;
                };
                
                const formatTimeAgo = (isoString) => {
                    if (!isoString) return 'Never';
                    const date = new Date(isoString);
                    const now = new Date();
                    const diffMs = now - date;
                    const diffMins = Math.floor(diffMs / 60000);
                    const diffHours = Math.floor(diffMins / 60);
                    const diffDays = Math.floor(diffHours / 24);
                    
                    if (diffMins < 1) return 'Just now';
                    if (diffMins < 60) return `${diffMins}m ago`;
                    if (diffHours < 24) return `${diffHours}h ago`;
                    return `${diffDays}d ago`;
                };
                
                // Scanner functions
                const toggleModule = (key) => {
                    const idx = selectedModules.value.indexOf(key);
                    if (idx > -1) selectedModules.value.splice(idx, 1);
                    else selectedModules.value.push(key);
                };
                
                const startScan = async () => {
                    if (!target.value || scanning.value) return;
                    scanning.value = true;
                    progress.value = 0;
                    results.value = null;
                    expandedFindings.value = [];
                    
                    try {
                        const response = await fetch('api/scan', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                target: target.value,
                                modules: selectedModules.value,
                                timeout: timeout.value
                            })
                        });
                        const data = await response.json();
                        scanId.value = data.scan_id;
                        pollStatus();
                    } catch (error) {
                        console.error('Scan error:', error);
                        scanning.value = false;
                    }
                };
                
                const pollStatus = async () => {
                    if (!scanId.value) return;
                    try {
                        const response = await fetch(`api/scan/${scanId.value}`);
                        const data = await response.json();
                        progress.value = data.progress || 0;
                        currentModule.value = data.current_module || '';
                        
                        if (data.status === 'completed') {
                            results.value = data.results;
                            scanning.value = false;
                            refreshAgentData();  // Refresh agent stats after scan
                        } else if (data.status === 'running' || data.status === 'pending') {
                            setTimeout(pollStatus, 500);
                        }
                    } catch (error) {
                        console.error('Poll error:', error);
                        scanning.value = false;
                    }
                };
                
                const toggleFinding = (index) => {
                    const idx = expandedFindings.value.indexOf(index);
                    if (idx > -1) expandedFindings.value.splice(idx, 1);
                    else expandedFindings.value.push(index);
                };
                
                const severityIcon = (severity) => {
                    const icons = { critical: 'üî¥', high: 'üü†', medium: 'üü°', low: 'üîµ', info: '‚ö™' };
                    return icons[severity?.toLowerCase()] || '‚ö™';
                };
                
                const severityBgClass = (severity) => {
                    const classes = {
                        critical: 'bg-red-900/50 text-red-300 border-red-800',
                        high: 'bg-orange-900/50 text-orange-300 border-orange-800',
                        medium: 'bg-yellow-900/50 text-yellow-300 border-yellow-800',
                        low: 'bg-blue-900/50 text-blue-300 border-blue-800',
                        info: 'bg-gray-700 text-gray-300 border-gray-600'
                    };
                    return classes[severity?.toLowerCase()] || classes.info;
                };
                
                const sortedFindings = computed(() => {
                    if (!results.value) return [];
                    const order = ['critical', 'high', 'medium', 'low', 'info'];
                    return [...results.value.findings].sort((a, b) => {
                        return order.indexOf(a.severity?.toLowerCase()) - order.indexOf(b.severity?.toLowerCase());
                    });
                });
                
                const riskColor = computed(() => {
                    if (!results.value) return 'text-white';
                    const score = results.value.risk_score;
                    if (score >= 70) return 'text-red-500';
                    if (score >= 40) return 'text-orange-500';
                    if (score >= 10) return 'text-yellow-500';
                    return 'text-green-500';
                });
                
                const riskLevel = computed(() => {
                    if (!results.value) return '';
                    const score = results.value.risk_score;
                    if (score >= 70) return 'High Risk';
                    if (score >= 40) return 'Medium Risk';
                    if (score >= 10) return 'Low Risk';
                    return 'Minimal Risk';
                });
                
                const formatTime = (isoString) => new Date(isoString).toLocaleString();
                
                const downloadReport = (format) => {
                    if (!scanId.value) return;
                    window.open(`api/scan/${scanId.value}/report?format=${format}`, '_blank');
                };
                
                return {
                    activeTab, target, timeout, modules, selectedModules,
                    scanning, progress, currentModule, results, expandedFindings,
                    agents, activities, discoveries,
                    toggleModule, startScan, toggleFinding,
                    severityIcon, severityBgClass, sortedFindings,
                    riskColor, riskLevel, formatTime, formatTimeAgo, downloadReport,
                    triggerDiscovery, triggerPRAgent, updateDiscoveryStatus,
                    getAgentIcon, categoryClass, statusClass
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
