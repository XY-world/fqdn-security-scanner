<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FQDN Security Scanner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
        .pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen">
    <div id="app">
        <!-- Header -->
        <header class="bg-gray-800 border-b border-gray-700 sticky top-0 z-50">
            <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <span class="text-2xl">üîê</span>
                    <h1 class="text-xl font-bold">FQDN Security Scanner</h1>
                </div>
                <a href="https://github.com/XY-world/fqdn-security-scanner" target="_blank" 
                   class="text-gray-400 hover:text-white transition">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                    </svg>
                </a>
            </div>
        </header>

        <main class="max-w-7xl mx-auto px-4 py-8">
            <!-- Scan Form -->
            <div class="bg-gray-800 rounded-xl p-6 mb-8 border border-gray-700">
                <div class="flex flex-col md:flex-row gap-4">
                    <div class="flex-1">
                        <label class="block text-sm font-medium text-gray-400 mb-2">Target Domain</label>
                        <input v-model="target" type="text" 
                               placeholder="example.com or https://example.com"
                               class="w-full bg-gray-900 border border-gray-600 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition"
                               @keyup.enter="startScan">
                    </div>
                    <div class="md:w-48">
                        <label class="block text-sm font-medium text-gray-400 mb-2">Timeout (sec)</label>
                        <input v-model.number="timeout" type="number" min="5" max="120"
                               class="w-full bg-gray-900 border border-gray-600 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition">
                    </div>
                    <div class="md:w-32 flex items-end">
                        <button @click="startScan" :disabled="scanning || !target"
                                class="w-full bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white font-semibold py-3 px-6 rounded-lg transition flex items-center justify-center space-x-2">
                            <span v-if="scanning" class="pulse">‚è≥</span>
                            <span v-else>üîç</span>
                            <span>[[ scanning ? 'Scanning...' : 'Scan' ]]</span>
                        </button>
                    </div>
                </div>

                <!-- Module Selection -->
                <div class="mt-4">
                    <label class="block text-sm font-medium text-gray-400 mb-2">Modules</label>
                    <div class="flex flex-wrap gap-2">
                        <button v-for="(info, key) in modules" :key="key"
                                @click="toggleModule(key)"
                                :class="selectedModules.includes(key) ? 'bg-blue-600 border-blue-500' : 'bg-gray-700 border-gray-600 hover:border-gray-500'"
                                class="px-4 py-2 rounded-lg border transition flex items-center space-x-2">
                            <span>[[ info.icon ]]</span>
                            <span>[[ info.name ]]</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Progress Bar -->
            <div v-if="scanning" class="bg-gray-800 rounded-xl p-6 mb-8 border border-gray-700">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-sm text-gray-400">Scanning [[ currentModule || '...' ]]</span>
                    <span class="text-sm text-gray-400">[[ progress ]]%</span>
                </div>
                <div class="w-full bg-gray-700 rounded-full h-2">
                    <div class="bg-blue-600 h-2 rounded-full transition-all duration-300"
                         :style="{ width: progress + '%' }"></div>
                </div>
            </div>

            <!-- Results -->
            <div v-if="results" class="space-y-6">
                <!-- Summary Cards -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <!-- Risk Score -->
                    <div class="bg-gray-800 rounded-xl p-6 border border-gray-700">
                        <div class="text-sm text-gray-400 mb-1">Risk Score</div>
                        <div class="text-4xl font-bold" :class="riskColor">[[ results.risk_score ]]/100</div>
                        <div class="text-sm mt-1" :class="riskColor">[[ riskLevel ]]</div>
                    </div>
                    
                    <!-- Findings Count -->
                    <div class="bg-gray-800 rounded-xl p-6 border border-gray-700">
                        <div class="text-sm text-gray-400 mb-1">Total Findings</div>
                        <div class="text-4xl font-bold text-white">[[ results.findings.length ]]</div>
                    </div>
                    
                    <!-- Critical/High -->
                    <div class="bg-gray-800 rounded-xl p-6 border border-gray-700">
                        <div class="text-sm text-gray-400 mb-1">Critical + High</div>
                        <div class="text-4xl font-bold text-red-500">
                            [[ (results.severity_summary.critical || 0) + (results.severity_summary.high || 0) ]]
                        </div>
                    </div>
                    
                    <!-- Scan Time -->
                    <div class="bg-gray-800 rounded-xl p-6 border border-gray-700">
                        <div class="text-sm text-gray-400 mb-1">Target</div>
                        <div class="text-xl font-bold text-white truncate">[[ results.target ]]</div>
                        <div class="text-xs text-gray-500 mt-1">[[ formatTime(results.scan_time) ]]</div>
                    </div>
                </div>

                <!-- Severity Breakdown -->
                <div class="bg-gray-800 rounded-xl p-6 border border-gray-700">
                    <h3 class="text-lg font-semibold mb-4">Severity Breakdown</h3>
                    <div class="flex flex-wrap gap-4">
                        <div v-for="(count, severity) in results.severity_summary" :key="severity"
                             class="flex items-center space-x-2 px-4 py-2 rounded-lg"
                             :class="severityBgClass(severity)">
                            <span>[[ severityIcon(severity) ]]</span>
                            <span class="font-medium capitalize">[[ severity ]]</span>
                            <span class="font-bold">[[ count ]]</span>
                        </div>
                    </div>
                </div>

                <!-- Findings List -->
                <div class="bg-gray-800 rounded-xl border border-gray-700 overflow-hidden">
                    <div class="px-6 py-4 border-b border-gray-700 flex items-center justify-between">
                        <h3 class="text-lg font-semibold">Findings</h3>
                        <div class="flex space-x-2">
                            <button @click="downloadReport('json')" 
                                    class="text-sm px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded transition">JSON</button>
                            <button @click="downloadReport('md')" 
                                    class="text-sm px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded transition">Markdown</button>
                            <button @click="downloadReport('html')" 
                                    class="text-sm px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded transition">HTML</button>
                        </div>
                    </div>
                    
                    <div v-if="results.findings.length === 0" class="px-6 py-12 text-center text-gray-500">
                        ‚úÖ No security issues found!
                    </div>
                    
                    <div v-else class="divide-y divide-gray-700">
                        <div v-for="(finding, index) in sortedFindings" :key="index"
                             class="px-6 py-4 hover:bg-gray-750 transition cursor-pointer"
                             @click="toggleFinding(index)">
                            <div class="flex items-start space-x-4">
                                <span class="text-xl">[[ severityIcon(finding.severity) ]]</span>
                                <div class="flex-1 min-w-0">
                                    <div class="flex items-center space-x-2 mb-1">
                                        <span class="text-xs px-2 py-0.5 rounded uppercase font-medium"
                                              :class="severityBgClass(finding.severity)">
                                            [[ finding.severity ]]
                                        </span>
                                        <span class="text-xs text-gray-500">[[ finding.module ]]</span>
                                    </div>
                                    <h4 class="font-medium">[[ finding.title ]]</h4>
                                    <p class="text-sm text-gray-400 mt-1">[[ finding.description ]]</p>
                                    
                                    <div v-if="expandedFindings.includes(index)" class="mt-3 space-y-2">
                                        <div v-if="finding.remediation" class="bg-green-900/30 border border-green-800 rounded-lg p-3">
                                            <div class="text-xs text-green-400 font-medium mb-1">Remediation</div>
                                            <p class="text-sm text-green-300">[[ finding.remediation ]]</p>
                                        </div>
                                        <div v-if="finding.references && finding.references.length">
                                            <div class="text-xs text-gray-500 mb-1">References</div>
                                            <a v-for="ref in finding.references" :key="ref" :href="ref" target="_blank"
                                               class="text-sm text-blue-400 hover:underline block">[[ ref ]]</a>
                                        </div>
                                    </div>
                                </div>
                                <span class="text-gray-500">[[ expandedFindings.includes(index) ? '‚ñº' : '‚ñ∂' ]]</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Module Details -->
                <div class="bg-gray-800 rounded-xl border border-gray-700 overflow-hidden">
                    <div class="px-6 py-4 border-b border-gray-700">
                        <h3 class="text-lg font-semibold">Module Details</h3>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 p-6">
                        <div v-for="(data, module) in results.module_results" :key="module"
                             class="bg-gray-900 rounded-lg p-4 border border-gray-700">
                            <div class="flex items-center space-x-2 mb-3">
                                <span>[[ modules[module]?.icon || 'üì¶' ]]</span>
                                <span class="font-medium capitalize">[[ module ]]</span>
                                <span v-if="data.error" class="text-red-400 text-xs">Error</span>
                            </div>
                            
                            <!-- DNS -->
                            <div v-if="module === 'dns' && !data.error" class="text-sm space-y-1">
                                <div class="flex justify-between">
                                    <span class="text-gray-400">DNSSEC</span>
                                    <span :class="data.dnssec?.enabled ? 'text-green-400' : 'text-red-400'">
                                        [[ data.dnssec?.enabled ? '‚úì Enabled' : '‚úó Disabled' ]]
                                    </span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">SPF</span>
                                    <span :class="data.email_security?.spf?.present ? 'text-green-400' : 'text-yellow-400'">
                                        [[ data.email_security?.spf?.present ? '‚úì' : '‚úó' ]]
                                    </span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">DMARC</span>
                                    <span :class="data.email_security?.dmarc?.present ? 'text-green-400' : 'text-yellow-400'">
                                        [[ data.email_security?.dmarc?.present ? '‚úì' : '‚úó' ]]
                                    </span>
                                </div>
                            </div>
                            
                            <!-- SSL -->
                            <div v-if="module === 'ssl' && !data.error && data.certificate" class="text-sm space-y-1">
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Protocol</span>
                                    <span class="text-green-400">[[ data.certificate.protocol_version ]]</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Expires</span>
                                    <span :class="data.certificate.expires_in_days > 30 ? 'text-green-400' : 'text-yellow-400'">
                                        [[ data.certificate.expires_in_days ]] days
                                    </span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Key</span>
                                    <span>[[ data.certificate.key_type ]] [[ data.certificate.key_size ]]-bit</span>
                                </div>
                            </div>
                            
                            <!-- Ports -->
                            <div v-if="module === 'ports' && !data.error" class="text-sm">
                                <div class="text-gray-400 mb-1">Open Ports</div>
                                <div class="flex flex-wrap gap-1">
                                    <span v-for="port in data.open_ports" :key="port"
                                          class="px-2 py-0.5 bg-gray-800 rounded text-xs">
                                        [[ port ]]
                                    </span>
                                    <span v-if="!data.open_ports?.length" class="text-gray-500">None detected</span>
                                </div>
                            </div>
                            
                            <!-- Subdomains -->
                            <div v-if="module === 'subdomains' && !data.error" class="text-sm">
                                <div class="text-gray-400 mb-1">Found [[ data.subdomains?.length || 0 ]] subdomains</div>
                                <div class="text-xs text-gray-500 truncate" v-for="sub in (data.subdomains || []).slice(0, 3)" :key="sub">
                                    [[ sub ]]
                                </div>
                            </div>
                            
                            <!-- Headers -->
                            <div v-if="module === 'headers' && !data.error" class="text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Missing</span>
                                    <span class="text-yellow-400">[[ data.missing_headers?.length || 0 ]]</span>
                                </div>
                            </div>
                            
                            <!-- Vulns -->
                            <div v-if="module === 'vulns' && !data.error" class="text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Exposed Paths</span>
                                    <span :class="data.exposed_paths?.length ? 'text-red-400' : 'text-green-400'">
                                        [[ data.exposed_paths?.length || 0 ]]
                                    </span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">security.txt</span>
                                    <span :class="data.security_txt?.found ? 'text-green-400' : 'text-gray-500'">
                                        [[ data.security_txt?.found ? '‚úì' : '‚úó' ]]
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="border-t border-gray-800 mt-12 py-6 text-center text-gray-500 text-sm">
            FQDN Security Scanner v1.0.0 ‚Ä¢ Built with üîê by XY-world
        </footer>
    </div>

    <script>
        const { createApp, ref, computed } = Vue;
        
        createApp({
            delimiters: ['[[', ']]'],
            setup() {
                const target = ref('');
                const timeout = ref(30);
                const modules = ref({{ modules | tojson }});
                const selectedModules = ref(Object.keys({{ modules | tojson }}));
                const scanning = ref(false);
                const scanId = ref(null);
                const progress = ref(0);
                const currentModule = ref('');
                const results = ref(null);
                const expandedFindings = ref([]);
                
                const toggleModule = (key) => {
                    const idx = selectedModules.value.indexOf(key);
                    if (idx > -1) {
                        selectedModules.value.splice(idx, 1);
                    } else {
                        selectedModules.value.push(key);
                    }
                };
                
                const startScan = async () => {
                    if (!target.value || scanning.value) return;
                    
                    scanning.value = true;
                    progress.value = 0;
                    results.value = null;
                    expandedFindings.value = [];
                    
                    try {
                        const response = await fetch('api/scan', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                target: target.value,
                                modules: selectedModules.value,
                                timeout: timeout.value
                            })
                        });
                        
                        const data = await response.json();
                        scanId.value = data.scan_id;
                        
                        // Poll for status
                        pollStatus();
                    } catch (error) {
                        console.error('Scan error:', error);
                        scanning.value = false;
                    }
                };
                
                const pollStatus = async () => {
                    if (!scanId.value) return;
                    
                    try {
                        const response = await fetch(`api/scan/${scanId.value}`);
                        const data = await response.json();
                        
                        progress.value = data.progress || 0;
                        currentModule.value = data.current_module || '';
                        
                        if (data.status === 'completed') {
                            results.value = data.results;
                            scanning.value = false;
                        } else if (data.status === 'running' || data.status === 'pending') {
                            setTimeout(pollStatus, 500);
                        }
                    } catch (error) {
                        console.error('Poll error:', error);
                        scanning.value = false;
                    }
                };
                
                const toggleFinding = (index) => {
                    const idx = expandedFindings.value.indexOf(index);
                    if (idx > -1) {
                        expandedFindings.value.splice(idx, 1);
                    } else {
                        expandedFindings.value.push(index);
                    }
                };
                
                const severityIcon = (severity) => {
                    const icons = {
                        critical: 'üî¥',
                        high: 'üü†',
                        medium: 'üü°',
                        low: 'üîµ',
                        info: '‚ö™'
                    };
                    return icons[severity?.toLowerCase()] || '‚ö™';
                };
                
                const severityBgClass = (severity) => {
                    const classes = {
                        critical: 'bg-red-900/50 text-red-300 border-red-800',
                        high: 'bg-orange-900/50 text-orange-300 border-orange-800',
                        medium: 'bg-yellow-900/50 text-yellow-300 border-yellow-800',
                        low: 'bg-blue-900/50 text-blue-300 border-blue-800',
                        info: 'bg-gray-700 text-gray-300 border-gray-600'
                    };
                    return classes[severity?.toLowerCase()] || classes.info;
                };
                
                const sortedFindings = computed(() => {
                    if (!results.value) return [];
                    const order = ['critical', 'high', 'medium', 'low', 'info'];
                    return [...results.value.findings].sort((a, b) => {
                        return order.indexOf(a.severity?.toLowerCase()) - order.indexOf(b.severity?.toLowerCase());
                    });
                });
                
                const riskColor = computed(() => {
                    if (!results.value) return 'text-white';
                    const score = results.value.risk_score;
                    if (score >= 70) return 'text-red-500';
                    if (score >= 40) return 'text-orange-500';
                    if (score >= 10) return 'text-yellow-500';
                    return 'text-green-500';
                });
                
                const riskLevel = computed(() => {
                    if (!results.value) return '';
                    const score = results.value.risk_score;
                    if (score >= 70) return 'High Risk';
                    if (score >= 40) return 'Medium Risk';
                    if (score >= 10) return 'Low Risk';
                    return 'Minimal Risk';
                });
                
                const formatTime = (isoString) => {
                    return new Date(isoString).toLocaleString();
                };
                
                const downloadReport = (format) => {
                    if (!scanId.value) return;
                    window.open(`api/scan/${scanId.value}/report?format=${format}`, '_blank');
                };
                
                return {
                    target, timeout, modules, selectedModules,
                    scanning, progress, currentModule, results,
                    expandedFindings, toggleModule, startScan,
                    toggleFinding, severityIcon, severityBgClass,
                    sortedFindings, riskColor, riskLevel, formatTime,
                    downloadReport
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
